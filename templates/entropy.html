{% extends "layout.html" %}

{% block content %}
<h1>
    Entropy-debugger
    <button class="uk-align-right uk-margin-small-top uk-button uk-button-default" type="button"
        uk-toggle="target: #toggle; animation:  uk-animation-fade"><span uk-icon="pencil"></span></button>
</h1>

<div id="toggle">
    <p>
        <label>
            Aggregation-function:
            <select class="uk-select" id="aggregator" name="aggregator">
                <option value="full-token-average" selected>full-token-average (default)</option>
                <option value="subtoken-average">subtoken-average</option>
                <option value="full-token-entropies">full-token-entropies</option>
            </select>
        </label>
    </p>

    <p>
        <label>
            Code
            <textarea class="uk-textarea" rows="10" id="content" name="content"></textarea>
        </label>
    </p>

    <button class="uk-button uk-button-primary" id="submit" type="button">Calculate entropies</button>

    <h2>Result</h2>
    
</div>

<div class="uk-flex">
    <div class="split preview" id="one">
        <pre id="result"><span></span></pre>
    </div>
    <div class="split" id="two">
        <pre id="code"><span></span></pre>
    </div>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript" src="{{ url_for('static', filename='js/split.min.js') }}"></script>
<script>
    Split(['#one', '#two'], {sizes: [25, 75]});
    $('.gutter.gutter-horizontal').addClass('uk-flex uk-flex-middle uk-flex-center').html('<span uk-icon="icon: more-vertical; ratio: 4"></span>');

    let result = $('#result');
    let code = $('#code');
    let loading = $('#loading');
    let btnSubmit = $('#submit');

    btnSubmit.click(function () {
        loading.show();
        btnSubmit.attr('disabled', 'disabled');
        result.html('<span></span>');
        code.html('<span></span>');
        let data = {
            extension: ".java",
            languageId: "java",
            filePath: "demo/temp",
            noReturn: false,
            timestamp: Date.now(),
            aggregator: $('#aggregator').val(),
            content: $('#content').val(),
        };

        axios.post('/languagemodel', data).then(response => {
            console.log("Got response entropy.html")
            console.log(response.data);
            insertLines({target: result, lines: response.data});
            insertLines({target: code, lines: data.content});
        }).catch(error => {
            console.log(error)
        }).finally(() => {
            loading.hide();
            btnSubmit.removeAttr('disabled');
        });
    });



</script>
{% endblock %}